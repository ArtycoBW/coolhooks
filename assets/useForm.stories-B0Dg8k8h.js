import{j as r}from"./jsx-runtime-DWbWqHZ-.js";import{r as n}from"./index-l2PZgWEW.js";function E(a){const{fields:t,onSubmit:p,validateOnChange:v=!0,validateOnBlur:g=!0,cacheKey:o}=a,[l,d]=n.useState(Object.keys(t).reduce((e,s)=>(e[s]={value:t[s].initialValue,error:null,touched:!1},e),{})),[O,y]=n.useState(!1);n.useEffect(()=>{if(o){const e=localStorage.getItem(o);e&&d(s=>({...s,...JSON.parse(e)}))}},[o]),n.useEffect(()=>{o&&localStorage.setItem(o,JSON.stringify(l))},[l,o]);const u=n.useCallback(async e=>{const{validator:s,asyncValidator:i}=t[e],c=l[e].value;let h=null;s&&(h=s(c,m())),!h&&i&&(h=await i(c,m())),d(x=>({...x,[e]:{...x[e],error:h}}))},[t,l]),V=n.useCallback(e=>s=>{const i=s.target.value;d(c=>({...c,[e]:{...c[e],value:i,touched:!0,error:c[e].error}})),v&&u(e)},[v,u]),F=n.useCallback(e=>()=>{d(s=>({...s,[e]:{...s[e],touched:!0}})),g&&u(e)},[g,u]),f=n.useCallback(async()=>{let e=!0;for(const s of Object.keys(t))await u(s),l[s].error&&(e=!1);return e},[t,l,u]),_=n.useCallback(async e=>{if(e.preventDefault(),y(!0),await f())try{await p(m())}catch(i){console.error("Ошибка при отправке формы",i)}y(!1)},[f,p]),B=n.useCallback(()=>{d(Object.keys(t).reduce((e,s)=>(e[s]={value:t[s].initialValue,error:null,touched:!1},e),{})),o&&localStorage.removeItem(o)},[t,o]),m=()=>Object.keys(l).reduce((e,s)=>(e[s]=l[s].value,e),{});return{values:m(),errors:Object.keys(l).reduce((e,s)=>(e[s]=l[s].error,e),{}),touched:Object.keys(l).reduce((e,s)=>(e[s]=l[s].touched,e),{}),isSubmitting:O,isValid:Object.keys(l).every(e=>l[e].error===null),handleChange:V,handleBlur:F,handleSubmit:_,resetForm:B,validateField:u,validateForm:f}}const D="_form_wlp1j_1",I="_fields_wlp1j_7",N="_buttons_wlp1j_35",j={form:D,fields:I,buttons:N},k=()=>{const a=E({fields:{username:{initialValue:"",validator:t=>t.trim()?null:"Username is required"},email:{initialValue:"",validator:t=>/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(t)?null:"Invalid email address"},password:{initialValue:"",asyncValidator:async t=>t.length>=6?null:"Password must be at least 6 characters long"}},onSubmit:async t=>{console.log("Form submitted:",t)},validateOnChange:!0,validateOnBlur:!0,cacheKey:"example-form"});return r.jsx("form",{onSubmit:a.handleSubmit,className:j.form,children:r.jsxs("div",{className:j.fields,children:[r.jsxs(r.Fragment,{children:[r.jsxs("label",{children:["Username:",r.jsx("input",{name:"username",value:a.values.username,onChange:a.handleChange("username"),onBlur:a.handleBlur("username")})]}),a.errors.username&&r.jsx("div",{style:{color:"#029cfd"},children:a.errors.username})]}),r.jsxs(r.Fragment,{children:[r.jsxs("label",{children:["Email:",r.jsx("input",{name:"email",value:a.values.email,onChange:a.handleChange("email"),onBlur:a.handleBlur("email")})]}),a.errors.email&&r.jsx("div",{style:{color:"#029cfd"},children:a.errors.email})]}),r.jsxs(r.Fragment,{children:[r.jsxs("label",{children:["Password:",r.jsx("input",{name:"password",type:"password",value:a.values.password,onChange:a.handleChange("password"),onBlur:a.handleBlur("password")})]}),a.errors.password&&r.jsx("div",{style:{color:"#029cfd"},children:a.errors.password})]}),r.jsxs("div",{className:j.buttons,children:[r.jsx("button",{type:"submit",disabled:a.isSubmitting,children:"Submit"}),r.jsx("button",{type:"button",onClick:a.resetForm,children:"Reset"})]})]})})},R={title:"Хуки/useForm",component:k},J=()=>r.jsx(k,{}),b=J.bind({});var S,w,C;b.parameters={...b.parameters,docs:{...(S=b.parameters)==null?void 0:S.docs,source:{originalSource:"() => <Demo />",...(C=(w=b.parameters)==null?void 0:w.docs)==null?void 0:C.source}}};const U=["Default"];export{b as Default,U as __namedExportsOrder,R as default};
