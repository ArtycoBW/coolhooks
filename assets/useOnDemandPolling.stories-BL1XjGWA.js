import{j as n}from"./jsx-runtime-DWbWqHZ-.js";import{r as t}from"./index-l2PZgWEW.js";function I({initialInterval:b,onPoll:u,enabled:p=!0,maxAttempts:h=5,onError:a,immediateStart:l=!1}){const[i,x]=t.useState(b),[c,d]=t.useState(0),s=t.useRef(null),e=t.useRef(u);t.useEffect(()=>{e.current=u},[u]);const D=t.useCallback(C=>{x(C)},[]),g=t.useCallback(async()=>{try{await e.current(),d(0)}catch(C){a&&a(C),c<h?d(c+1):r()}},[c,h,a]),m=t.useCallback(()=>{s.current===null&&(l&&g(),s.current=setInterval(()=>{g()},i))},[i,g,l]),r=t.useCallback(()=>{s.current!==null&&(clearInterval(s.current),s.current=null)},[]);return t.useEffect(()=>(p?m():r(),()=>r()),[p,m,r]),t.useEffect(()=>{s.current!==null&&(r(),m())},[i,m,r]),{changeInterval:D,startPolling:m,stopPolling:r}}const y="_wrapper_1pgro_1",E="_info_1pgro_8",N="_buttons_1pgro_14",o={wrapper:y,info:E,buttons:N},k=()=>{const[b,u]=t.useState("Загрузка..."),[p,h]=t.useState(5e3),[a,l]=t.useState(null),i=t.useCallback(async()=>{try{const e=Math.random()*100;if(console.log(`Полученные данные: ${e.toFixed(2)}`),Math.random()<.1)throw new Error("Ошибка случайного запроса");u(`Полученные данные: ${e.toFixed(2)}`),l(null)}catch(e){l(e.message),console.error("Ошибка при запросе:",e)}},[]),x=t.useCallback(e=>{console.error("Ошибка опроса:",e),l(e.message)},[]),{changeInterval:c,startPolling:d,stopPolling:s}=I({initialInterval:p,onPoll:i,enabled:!0,maxAttempts:3,onError:x,immediateStart:!0});return n.jsxs("div",{className:o.wrapper,children:[n.jsxs("p",{className:o.info,children:["Данные с сервера: ",n.jsx("code",{children:a?`Ошибка: ${a}`:b})]}),n.jsxs("div",{className:o.buttons,children:[n.jsx("button",{type:"button",onClick:()=>c(1e4),className:o.button,children:"Установить интервал на 10 секунд"}),n.jsx("button",{type:"button",onClick:()=>c(3e3),className:o.button,children:"Установить интервал на 3 секунды"}),n.jsx("button",{type:"button",onClick:d,className:o.button,children:"Начать опрос"}),n.jsx("button",{type:"button",onClick:s,className:o.button,children:"Остановить опрос"})]})]})},O={title:"Хуки/useOnDemandPolling",component:k},w=()=>n.jsx(k,{}),f=w.bind({});var v,_,j;f.parameters={...f.parameters,docs:{...(v=f.parameters)==null?void 0:v.docs,source:{originalSource:"() => <Demo />",...(j=(_=f.parameters)==null?void 0:_.docs)==null?void 0:j.source}}};const R=["Default"];export{f as Default,R as __namedExportsOrder,O as default};
