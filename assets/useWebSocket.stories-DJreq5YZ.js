import{j as t}from"./jsx-runtime-DWbWqHZ-.js";import{r as e}from"./index-l2PZgWEW.js";const W=(f,x={})=>{const{shouldReconnect:u=!0,reconnectInterval:d=5e3,maxReconnectAttempts:b=1/0,protocols:S}=x,[l,r]=e.useState("CONNECTING"),[N,k]=e.useState(null),[i,a]=e.useState(null),s=e.useRef(null),m=e.useRef(0),C=e.useRef(null),g=()=>{C.current&&clearTimeout(C.current)},p=e.useCallback(()=>{const n=new WebSocket(f,S);r("CONNECTING"),n.onopen=()=>{r("OPEN"),a(null),m.current=0},n.onmessage=c=>{k(c.data)},n.onerror=c=>{a(c)},n.onclose=c=>{r("CLOSED"),c.code!==1e3&&u&&m.current<b&&(m.current+=1,C.current=setTimeout(()=>{p()},d))},s.current=n},[f,S,u,d,b]),w=e.useCallback(n=>{var c;s.current&&s.current.readyState===WebSocket.OPEN?s.current.send(n):console.error("WebSocket не открыт. Текущее состояние: ",(c=s.current)==null?void 0:c.readyState)},[]),y=e.useCallback(()=>{s.current&&(s.current.close(1e3,"Соединение закрыто клиентом"),m.current=0)},[]),I=e.useCallback(()=>{s.current&&s.current.readyState!==WebSocket.CLOSED&&s.current.close(1e3,"Ручное переподключение"),g(),m.current=0,p()},[p]);return e.useEffect(()=>(p(),()=>{var n;g(),(n=s.current)==null||n.close(1e3,"Компонент размонтирован")}),[p]),{status:l,message:N,sendMessage:w,closeConnection:y,reconnect:I,error:i}},O="_wrapper_1l9af_1",T="_connectionStatus_1l9af_12",D="_info_1l9af_16",v="_messageInput_1l9af_24",A="_input_1l9af_31",M="_button_1l9af_48",G="_messages_1l9af_71",o={wrapper:O,connectionStatus:T,info:D,messageInput:v,input:A,button:M,messages:G},R=()=>{const[f,x]=e.useState("Ожидание сообщения..."),[u,d]=e.useState(null),[b,S]=e.useState(0),{status:l,sendMessage:r,closeConnection:N,reconnect:k,message:i,error:a}=W("ws://localhost:8080",{shouldReconnect:!0,reconnectInterval:5e3,maxReconnectAttempts:5,protocols:void 0});return e.useEffect(()=>{i&&x(`Получено сообщение: ${i}`)},[i]),e.useEffect(()=>{a&&d(`Ошибка WebSocket: ${a.message}`)},[a]),e.useEffect(()=>{l==="CONNECTING"&&S(s=>s+1)},[l]),t.jsxs("div",{className:o.wrapper,children:[t.jsxs("p",{className:o.info,children:["Статус WebSocket: ",t.jsx("code",{children:l})]}),t.jsx("p",{className:o.info,children:u?t.jsx("code",{children:u}):f}),t.jsxs("p",{className:o.info,children:["Попытки подключения: ",t.jsx("code",{children:b})]}),t.jsxs("div",{className:o.buttons,children:[t.jsx("button",{type:"button",onClick:()=>r("Привет, сервер!"),className:o.button,children:"Отправить сообщение"}),t.jsx("button",{type:"button",onClick:()=>r("Ещё одно сообщение"),className:o.button,children:"Отправить ещё одно сообщение"}),t.jsx("button",{type:"button",onClick:N,className:o.button,children:"Закрыть соединение"}),t.jsx("button",{type:"button",onClick:k,className:o.button,children:"Повторное подключение"}),t.jsx("button",{type:"button",onClick:()=>window.location.reload(),className:o.button,children:"Перезагрузить страницу"})]})]})},q={title:"Хуки/useWebSocket",component:R},L=()=>t.jsx(R,{}),_=L.bind({});var E,h,j;_.parameters={..._.parameters,docs:{...(E=_.parameters)==null?void 0:E.docs,source:{originalSource:"() => <Demo />",...(j=(h=_.parameters)==null?void 0:h.docs)==null?void 0:j.source}}};const z=["Default"];export{_ as Default,z as __namedExportsOrder,q as default};
